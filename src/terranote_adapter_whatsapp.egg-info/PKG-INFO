Metadata-Version: 2.4
Name: terranote-adapter-whatsapp
Version: 0.1.0
Summary: WhatsApp adapter for Terranote core (fase 1)
Author: Terranote Contributors
License: GPL-3.0-or-later
Requires-Python: >=3.11
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fastapi==0.115.0
Requires-Dist: uvicorn[standard]==0.30.0
Requires-Dist: httpx==0.27.2
Requires-Dist: pydantic-settings==2.3.3
Requires-Dist: python-dotenv==1.2.1
Requires-Dist: structlog==24.4.0
Provides-Extra: dev
Requires-Dist: pytest==8.3.2; extra == "dev"
Requires-Dist: pytest-asyncio==0.23.8; extra == "dev"
Requires-Dist: pytest-cov==5.0.0; extra == "dev"
Requires-Dist: ruff==0.6.3; extra == "dev"
Requires-Dist: mypy==1.11.1; extra == "dev"
Requires-Dist: types-requests==2.32.0.20241016; extra == "dev"
Requires-Dist: respx==0.21.1; extra == "dev"
Dynamic: license-file

# terranote-adapter-whatsapp

Adaptador fase 1 para WhatsApp Cloud API que conecta con `terranote-core`.

## Requisitos

- Python 3.13+
- [virtualenv](https://virtualenv.pypa.io/) o equivalente

## Configuración rápida

```bash
python3 -m virtualenv .venv
. .venv/bin/activate
pip install -e .[dev]
uvicorn terranote_adapter_whatsapp.main:app --reload
```

Variables de entorno relevantes (`env.example`):

| Variable | Descripción |
| --- | --- |
| `APP_ENV` | Entorno de ejecución (`development`, `production`). |
| `CORE_API_BASE_URL` | URL base del módulo central. |
| `CORE_API_TIMEOUT_SECONDS` | Timeout en segundos para llamadas al núcleo. |
| `CORE_API_TOKEN` | Token opcional para autenticación contra el núcleo. |
| `WHATSAPP_VERIFY_TOKEN` | Token compartido para verificar el webhook de Meta. |
| `WHATSAPP_ACCESS_TOKEN` | Token de acceso para WhatsApp Cloud API. |
| `WHATSAPP_PHONE_NUMBER_ID` | Identificador del número asociado al bot. |
| `NOTIFIER_SECRET_TOKEN` | Secreto opcional para validar callbacks desde el core. |

## Pruebas

```bash
. .venv/bin/activate
pytest
```

## Estructura

- `src/terranote_adapter_whatsapp/main.py`: instancia de FastAPI.
- `src/terranote_adapter_whatsapp/routes`: endpoints (`/webhook`, `/callbacks`, `/health`).
- `src/terranote_adapter_whatsapp/services`: normalización de mensajes.
- `src/terranote_adapter_whatsapp/clients`: clientes HTTP hacia el núcleo y WhatsApp.
- `src/terranote_adapter_whatsapp/schemas`: modelos Pydantic.
- `tests`: pruebas unitarias con `pytest`.

## Próximos pasos

- Normalizar payloads de Meta y enviarlos al núcleo.
- Implementar envío de respuestas al usuario y manejo de callbacks.
- Añadir documentación detallada de integración y despliegue.
